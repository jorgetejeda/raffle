<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App Sorteo - AFP Crecer - Participantes</title>
    <link type="text/css" rel="stylesheet" href="styles/main.css" />
    <link type="text/css" rel="stylesheet" href="styles/util.css" />
    <link type="text/css" rel="stylesheet" href="styles/participants.css" />
</head>

<body class="loading" onload="onLoad()">

    <header></header>

    <main>
        <div class="container">
            <div id="menu-list"></div>

            <div class="header-content">
                <h1 class="title">Lista de participantes</h1>
                <button class="clear hidden" onclick="clearParticipants()">Limpiar lista de participantes</button>
            </div>

            <div class="card">
                <table id="data-table"></table>
            </div>
        </div>
    </main>

    <footer></footer>

    <script src="scripts/api.js"></script>
    <script src="scripts/common.js"></script>
    <script src="scripts/datatable.js"></script>
    <script>
        const onLoad = async () => {
            const { participants, status } = await callIn('GET', '/participants/view')
            if (status === 400) {
                console.log("it doesnt have prizes");
            }

            if (participants.length !== 0) {
                document.querySelector('.clear').classList.remove('hidden');
            }

            initDataTable({
                data: participants,
                columns: [
                    { name: 'name', title: 'Nombre Completo' },
                    { name: 'identification', title: 'Cedula' },
                    { name: 'department', title: 'Area o departamento' },
                    { name: 'company', title: 'Compania' },
                ],
                pagination: {
                    currentPage: 1,
                    LimitView: 10,
                    collectionView: [10, 20, 50],
                },
                hasSearch: true,
            })
        }

        const clearParticipants = () => {
            const confirmation = confirm('¿Está seguro que desea eliminar la lista de participantes?');
            if (!confirmation) return;
            fetch('/participants/delete', {
                method: 'DELETE'
            })
                .then(response => response.json())
                .then(json => {
                    if (json.success) {
                        alert('Lista de participantes eliminada');
                        window.location.reload();
                    }
                });
            onLoad();
        }

    </script>
</body>

</html>